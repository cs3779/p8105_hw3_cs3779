---
title: "Homework 3"
author: "CJ Snyder"
date: "10/10/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
library(httr)
library(jsonlite)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

# **Problem 1 - Uploading _Instacart_ Dataset:**
```{r, results='hide'}
library(p8105.datasets)
data ("instacart")

instacart
```

## **Dataset Description:**
The instacart dataset includes `r nrow(instacart)` observations, along with `r ncol(instacart)` variables including: `r names(instacart)`. 

Each item within an order is linked together using a particular _order_id_ and _product_id_, and includes information like when the order was made (*order_dow*, and *order_hour_of_day*), as well as where the item is located within the store (*`r names(instacart) [12:15]`*) and whether or not this item is being re-ordered (*reordered*). 
The amount of items ordered from each department is summarized in the below bar chart:
```{r, echo=FALSE}
instacart %>% 
  ggplot(aes(x=department)) + geom_bar(stat="count") +
    labs(x="Department where Item was Located", y="Amount Ordered") +
    scale_y_continuous(labels=scales::comma) +
    theme(axis.text.x = element_text(size=12,angle=90))
```

The largest number of orders occured on Sunday according to the below chart:
```{r, echo=FALSE}
instacart %>% 
  ggplot(aes(x=order_dow)) + geom_bar(stat="count") +
    labs(x="Day of the Week", y="Amount Ordered") +
    scale_y_continuous(labels=scales::comma) +
    scale_x_continuous(
      breaks = c(0,1,2,3,4,5,6),
      labels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday")) +
    theme(axis.text.x = element_text(size=12))
```

```{r, echo=FALSE}
aisle_count = 
  instacart %>% 
  group_by(aisle) %>% 
  count() %>% 
  arrange(desc(n)) 
```

The total number of aisles collected by _Instacart_ is `r summarize(instacart, count=n_distinct(aisle_id))`. The aisle that had the most items ordered from it was **`r aisle_count[1,1]`** with *`r aisle_count[1,2]`* items bought, followed closely by **`r aisle_count[2,1]`** with *`r aisle_count[2,2]`* items bought. 

The aisles that had over 10,000 items bought from them are shown in the below plot (organized from the items that were bought the most to those that were bought the least):
```{r, echo=FALSE, eval=FALSE}
aisle_count %>% 
  filter(n>10000) %>% 
  ggplot(aes(x=reorder(aisle,desc(n)),y=n)) + 
    geom_col() +
    labs(x="Aisle where Item was Located", y="Amount Ordered") +
    scale_y_continuous(labels=scales::comma) +
    theme(axis.text.x = element_text(size=11,angle=90))
```

```{r, echo=FALSE}
aisle_count %>% 
  filter(n>10000) %>% 
  ggplot(aes(x=reorder(aisle,desc(n)),y=n)) + 
    geom_point() +
    labs(x="Aisle where Item was Located", y="Amount Ordered") +
    scale_y_continuous(labels=scales::comma) +
    theme(axis.text.x = element_text(size=11,angle=90))
```

The three most popular items bought from aisles labeled as _"baking ingredients"_, _"dog food care"_, and _"packaged vegetables fruits"_ are as follows:
```{r, echo=FALSE}
aisle_table = 
  instacart %>% 
  group_by(aisle, product_id, product_name) %>% 
  summarize(count_prod = n()) %>% 
  filter(aisle %in% c("baking ingredients",
                      "dog food care",
                      "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  top_n(3, count_prod) %>% 
  rename("Aisle" = aisle,
         "Amount Bought" = count_prod,
         "Prodcut ID" = product_id,
         "Product Name" = product_name)

print(aisle_table)
```

The mean hour of the day in which _Pink Lady Apples_ and _Coffee Ice Cream_ are ordered throughout the week are listed in the table below:
```{r, echo=FALSE}
mean_hour_df = 
  instacart %>% 
  group_by(product_name, order_dow) %>%
  mutate(
    mean_hour = mean(order_hour_of_day)) %>% 
  filter(product_name %in% c("Pink Lady Apples",
                             "Coffee Ice Cream")) %>% 
  select(product_name, order_dow, mean_hour) %>% 
  distinct(mean_hour) %>% 
  ungroup(order_dow) %>% 
  mutate(
    order_dow = as.character(order_dow),
    order_dow = factor(order_dow, c(0, 1, 2, 3, 4, 5, 6), 
                       labels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
  )
mean_hour_df = 
  mean_hour_df[order(mean_hour_df$order_dow), ] %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) 
print(mean_hour_df)
```

# **Problem 2 - Uploading _BRFSS_ Dataset:**
```{r, results='hide'}
library(p8105.datasets)
data("brfss_smart2010")

brfss_smart2010
```

## Data Cleaning for _brfss_smar2010_ dataset:
```{r}
names(brfss_smart2010)[] <- tolower(names(brfss_smart2010)[])

brfss_smart2010 %>% 
  filter(topic=="Overall Health") %>% 
  count(response)

brfss_smart2010 = 
  brfss_smart2010 %>% 
    filter(topic=="Overall Health",
           response %in% c("Excellent", "Fair", "Good", "Poor")
           ) %>%
  mutate(
    response = as.character(response),
    response = factor(response,levels=c("Poor", "Fair", "Good", "Excellent"))
  )
```

### Question 2a 
```{r}
brfss_2002 = 
  brfss_smart2010 %>% 
    filter(year=="2002") %>% 
    group_by(locationabbr) %>% 
    summarize(
      unique_location = n_distinct(locationdesc)
    ) %>% 
  filter(unique_location>=7)

print(brfss_2002)
```
In 2002, the states that had 7 or more locations from which the government collected data include Connecticut, Florida, Massachusetts, North Carolina, New Jersey, and Pennsylvania

```{r}
brfss_2010 = 
  brfss_smart2010 %>% 
    filter(year=="2010") %>% 
    group_by(locationabbr) %>% 
    summarize(
      unique_location = n_distinct(locationdesc)
    ) %>% 
  filter(unique_location>=7)

print(brfss_2010)
```
While in 2010, the stats that had 7 or more locations from which the government collected data include California, Colorodo, Florida, Massachusetts, Maryland, North Carolina, Nebraska, New Jersey, New York, Ohio, Pennsylvania, South Carolina, Texas and Washington.



